# MCP Chain

Учебно-боевой блокчейн на Go.

## Краткое описание
- Модель: Proof-of-Cooperation. Один валидатор (пока), stake ≥ 1000 $MCP, блок подписью Ed25519.
- MVP работает офлайн, в одном процессе: никакого p2p, мостов, оракулов. Данные лежат в embedded Prestige DB (пока мок).
- Genesis-блок начисляет 1111 $MCP на адрес GENESIS и сразу лочит stake валидатора.
- Блок ≤ 100 транзакций **или** 10 мин с момента последнего — тогда «mine».
- Комиссия фикс 0.001 $MCP, награда за блок задаётся конфигом.
- Смарт-контракты первого уровня («Proto API») прошиты в коде:  
  • CreateCoop • Vote • IssueToken
- CLI на Cobra: wallet | send | chain | stake | contract call.
- Состояние сети (балансы, стейки, последние N операций) держится в памяти (`state.go`) и периодически дампится в `data/state.json` для быстрого старта.

## Архитектурные принципы
- **Все типы данных** (`Block`, `Transaction`, `SCTx`, `Header`, `Body` и др.) вынесены в папку [`types/`](types/), чтобы избежать дублирования и циклических зависимостей.
- **Все параметры и константы** (минимальный стейк, награда за блок, адрес GENESIS и др.) вынесены в [`internal/config/network_config.go`](internal/config/network_config.go) и доступны только через конфиг.
- **SOLID-архитектура:**
  - Все зависимости между слоями реализованы через интерфейсы (`Contract`, `Mempool`, `DB`, `Peer`, `Broadcaster`).
  - Контракты расширяются через интерфейс `Contract` (можно добавлять новые без изменения диспетчера).
  - Mempool реализует интерфейс `Mempool` (можно подменять реализацию).
  - Chain, storage, state, mempool, API и CLI не зависят друг от друга напрямую, только через абстракции.
- **Нет магических чисел** — только через конфиг.
- **CLI и API** не содержат бизнес-логики, только маршрутизацию и ввод/вывод.

## Структура проекта

```
mcp-chain/
├── cmd/
│   └── mcp/
├── internal/
│   ├── config/
│   ├── errors/
│   └── utils/
├── types/
├── crypto/
├── db/
├── network/
├── core/
│   ├── blockchain/
│   ├── transaction/
│   ├── mempool/
│   ├── staking/
│   └── state/
├── contracts/
├── api/
├── cli/
├── logging/
├── scripts/
├── data/
└── README.md
```

## Быстрый старт

```sh
cd mcp-chain
# Сборка CLI
# go build -o mcp ./cmd/mcp
# Запуск (пример):
# ./mcp --data-dir ./data --log-level debug chain head
```

## Жёсткое правило
Все параметры (например, 1111, 0.001, 100, 10 мин и т.п.) должны быть только в `internal/config/network_config.go` или `node_config.go` и подтягиваться через конфиг — никаких "магических чисел" в коде.

## Расширяемость
- **Добавить новый контракт:** реализуйте интерфейс `Contract` и зарегистрируйте его в диспетчере.
- **Добавить новый тип mempool:** реализуйте интерфейс `Mempool` и используйте его в ядре.
- **Подключить реальную БД или p2p:** реализуйте интерфейс `DB` или `Peer`/`Broadcaster` и подмените заглушку.

## Жизненный цикл транзакции

1. **Создание**: Транзакция отправляется через API (`/v1/tx/send`) или CLI.
2. **Mempool**: Транзакция попадает в глобальный mempool Node.
3. **Майнинг**: Node формирует блок из транзакций mempool.
4. **Применение**: Транзакции из блока применяются к state, state сохраняется в `state.json`.
5. **Баланс**: Баланс меняется только после майнинга блока.

## Основные API эндпоинты
- `POST /v1/wallet/import` — импортировать кошелек
- `GET /v1/wallet/list` — список кошельков
- `POST /v1/tx/send` — отправить транзакцию
- `GET /v1/state/summary` — статус сети

## Пример работы
1. Запусти Node: `./mcp node`
2. Импортируй кошелек через API:
   ```sh
   curl -X POST -H "Content-Type: application/json" -d '{"seed":"..."}' http://localhost:8080/v1/wallet/import
   ```
3. Отправь транзакцию:
   ```sh
   curl -X POST -H "Content-Type: application/json" -d '{"from":"...","to":"...","amount":10,"fee":1,"seed":"..."}' http://localhost:8080/v1/tx/send
   ```
4. Дождись майнинга блока — баланс изменится.

## Важно
- Баланс меняется только после майнинга блока.
- Все транзакции видны в блоках (и хэши, и объекты).
- Mempool не сериализуется в файл, это RAM-очередь.

Проект полностью соответствует принципам модульности, расширяемости и чистоты архитектуры.

## CLI

В проекте реализован мощный CLI-интерфейс для управления блокчейном, кошельками, стейкингом, транзакциями и смарт-контрактами.

- Все команды CLI, примеры использования и подробная инструкция находятся в [cli/cli.md](cli/cli.md).
- CLI не содержит бизнес-логики, только маршрутизацию и ввод/вывод.

Пример запуска:
```sh
./mcp wallet new
./mcp chain head
./mcp contract proto-call CreateCoop creator=0x123 name=TestCoop description=Demo
``` 